<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Rasuli Carpets | heritage rugs</title>
    <style>
        /* ====== PREMIUM STYLING (unchanged) ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background-color: #f9f3ea;
            color: #3f3328;
            line-height: 1.5;
            scroll-behavior: smooth;
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        body.loaded { opacity: 1; }
        .hero {
            background: linear-gradient(115deg, rgba(100, 70, 40, 0.55), rgba(160, 120, 70, 0.25)), 
                        url('https://images.unsplash.com/photo-1600166898405-da9535204843?q=80&w=2070&auto=format&fit=crop') center/cover no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        h1, h2, h3, .title-font {
            font-family: 'Cormorant Garamond', 'Times New Roman', serif;
            font-weight: 400;
            letter-spacing: 0.03em;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 2rem 1.8rem;
        }
        #welcome-overlay {
            position: fixed;
            inset: 0;
            background: #1d1510;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            pointer-events: none;
            opacity: 1;
            backdrop-filter: blur(10px);
        }
        #welcome-overlay.fade-out { opacity: 0; }
        .welcome-text {
            color: #efddc9;
            font-size: clamp(2.5rem, 15vw, 6rem);
            font-family: 'Cormorant Garamond', serif;
            font-weight: 300;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            border-bottom: 1px solid rgba(212, 175, 115, 0.5);
            padding-bottom: 1rem;
            animation: softGlow 2.2s infinite alternate;
        }
        @keyframes softGlow {
            0% { text-shadow: 0 0 8px #c6a062; }
            100% { text-shadow: 0 0 30px #e5bc86; }
        }
        .cart-area {
            position: fixed;
            top: 1.8rem;
            right: 2rem;
            z-index: 500;
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .cart-icon {
            background: #fefcf7e0;
            backdrop-filter: blur(8px);
            border-radius: 50px;
            padding: 0.7rem 1.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            box-shadow: 0 12px 28px -10px #4f3e2e;
            border: 1px solid #e1cfb5;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cart-icon:hover { background: white; box-shadow: 0 20px 30px -10px #a67c4e; }
        .cart-count {
            background: #b28b63;
            color: white;
            border-radius: 40px;
            padding: 0.15rem 0.7rem;
            font-size: 0.9rem;
        }
        .cart-dropdown {
            position: absolute;
            top: 70px;
            right: 0;
            width: 340px;
            background: rgba(255, 250, 240, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 30px 50px -20px #271e15;
            padding: 1.5rem 1rem;
            border: 1px solid #dbbc96;
            display: none;
            max-height: 70vh;
            overflow-y: auto;
        }
        .cart-dropdown.show { display: block; }
        .cart-item {
            display: flex; gap: 1rem; align-items: center; border-bottom: 1px dashed #c7aa84; padding: 0.9rem 0;
        }
        .cart-item img { width: 50px; height: 50px; object-fit: cover; border-radius: 10px; }
        .cart-item-info { flex:1; }
        .cart-item-remove { background: none; border: 1px solid #bba27a; border-radius: 30px; padding: 0.2rem 1rem; cursor: pointer; }
        .hero-content {
            text-align: center;
            color: white;
            text-shadow: 0 4px 18px #20170f;
        }
        .hero-content h1 {
            font-size: clamp(4rem, 16vw, 8rem);
            color: #f9edde;
        }
        .hero-content p {
            font-size: clamp(1.3rem, 5vw, 2.2rem);
            font-weight: 300;
            letter-spacing: 6px;
            margin: 1rem 0 2.8rem;
        }
        .btn-hero {
            background: transparent;
            border: 2px solid white;
            color: white;
            padding: 1.2rem 3.8rem;
            font-size: 1.2rem;
            letter-spacing: 2px;
            cursor: pointer;
            transition: 0.4s;
            backdrop-filter: blur(12px);
            background-color: #ffffff1a;
            border-radius: 60px;
            font-weight: 300;
        }
        .btn-hero:hover {
            background: #e5cdb0;
            color: #281e14;
            border-color: #e5cdb0;
        }
        .section-title {
            font-size: 3.8rem;
            text-align: center;
            margin: 3rem 0 1rem;
            color: #4e3b28;
            font-weight: 300;
            border-bottom: 1px solid #c1a885;
            display: inline-block;
            padding-bottom: 0.5rem;
        }
        .filter-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0 3rem;
            flex-wrap: wrap;
        }
        .filter-btn {
            background: #ece1d1;
            border: none;
            font-size: 1.5rem;
            font-family: 'Cormorant Garamond', serif;
            padding: 0.8rem 2.8rem;
            border-radius: 50px;
            box-shadow: 0 8px 16px -8px #b2916e;
            cursor: pointer;
            transition: 0.2s;
            color: #3d2e1f;
            border: 1px solid #d2b48c;
        }
        .filter-btn.active {
            background: #9f825d;
            color: white;
            box-shadow: 0 0 0 2px #edd7be;
        }
        .filter-btn:hover { background: #cfb794; transform: translateY(-3px); }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 2.2rem;
            margin: 3rem 0;
        }
        .product-card {
            background: #ffffffd9;
            backdrop-filter: blur(5px);
            border-radius: 32px;
            overflow: hidden;
            box-shadow: 0 20px 35px -15px #7c654b;
            transition: all 0.4s;
            border: 1px solid #ebddcd;
            display: flex;
            flex-direction: column;
        }
        .product-card:hover {
            transform: translateY(-14px) scale(1.01);
            box-shadow: 0 30px 50px -15px #8b6d4e;
            border-color: #c7a46b;
        }
        .product-img {
            width: 100%;
            height: 260px;
            object-fit: cover;
        }
        .card-content {
            padding: 1.5rem 1.2rem 1.8rem;
        }
        .product-name {
            font-size: 1.9rem;
            font-family: 'Cormorant Garamond', serif;
            color: #3e2b19;
        }
        .product-size {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #a48158;
        }
        .product-desc {
            font-size: 0.95rem;
            color: #504132;
            margin: 0.5rem 0;
        }
        .add-btn {
            background: #3f2f21;
            color: #f2dfc9;
            border: none;
            padding: 0.9rem;
            border-radius: 50px;
            font-weight: 500;
            letter-spacing: 1px;
            margin-top: 0.8rem;
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid #a28664;
        }
        .add-btn:hover { background: #624b36; color: white; }
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: 0.3s;
        }
        .modal-overlay.show {
            visibility: visible;
            opacity: 1;
        }
        .modal-content {
            background: #1f1a15;
            color: #f0e2d2;
            border-radius: 48px;
            padding: 2.5rem;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid #b4946a;
            box-shadow: 0 30px 60px rgba(0,0,0,0.6);
        }
        .modal-content h3 {
            font-size: 2.5rem;
            color: #ebd3b5;
            margin-bottom: 1.5rem;
        }
        .close-modal {
            float: right;
            font-size: 2rem;
            cursor: pointer;
            color: #b4946a;
            background: none;
            border: none;
            line-height: 1;
        }
        .modal-form input, .modal-form select, .modal-form textarea {
            width: 100%;
            padding: 0.9rem 1.2rem;
            margin: 0.8rem 0;
            border-radius: 40px;
            border: 1px solid #b4946a;
            background: #2c241c;
            color: #f0e2d2;
            font-size: 1rem;
        }
        .modal-form input[type="file"] {
            background: #3b3127;
            padding: 0.5rem;
        }
        .modal-form button {
            background: #846b4e;
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 40px;
            font-size: 1rem;
            margin: 0.5rem 0.5rem 0 0;
            cursor: pointer;
            transition: 0.2s;
        }
        .modal-form button:hover { background: #9f825d; }
        .modal-form button.secondary { background: #5a4a38; }
        .image-preview { max-width: 100px; border-radius: 16px; margin: 10px 0; }
        .admin-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #2c241c;
            padding: 0.8rem;
            border-radius: 40px;
            margin: 0.5rem 0;
            flex-wrap: wrap;
        }
        .admin-item img { width: 50px; height: 50px; border-radius: 12px; object-fit: cover; }
        .admin-item button {
            padding: 0.4rem 1rem;
            border-radius: 40px;
            border: none;
            cursor: pointer;
        }
        .error-msg { color: #d88; margin-top: 0.5rem; }
        .contact-section {
            background: #e3d6c4;
            border-radius: 120px 20px 120px 20px;
            padding: 3.5rem 2rem;
            margin: 5rem 0;
            display: flex;
            justify-content: center;
            gap: 3rem;
            flex-wrap: wrap;
        }
        .contact-btn {
            background: #2b241e;
            padding: 1.3rem 3.8rem;
            border-radius: 60px;
            color: #efdecb;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
            border: 1px solid #bc9f79;
            transition: 0.4s;
        }
        .contact-btn:hover { background: #4d3b2b; color: #fff; transform: scale(1.03); }
        footer {
            border-top: 1px solid #c7aa84;
            padding: 2rem 1rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            color: #3f3328;
            font-size: 0.95rem;
            gap: 1rem;
        }
        .fade-scroll { opacity: 0; transform: translateY(25px); transition: all 0.9s ease; }
        .fade-scroll.revealed { opacity: 1; transform: translateY(0); }
        @media (max-width: 600px) {
            .cart-area { right: 1rem; top: 1rem; }
            .cart-icon { padding: 0.5rem 1.2rem; }
            .cart-dropdown { width: 290px; right: -10px; }
            .filter-btn { font-size: 1.2rem; padding: 0.6rem 1.6rem; }
            .hero-content p { letter-spacing: 3px; }
            .btn-hero { padding: 1rem 2rem; font-size: 1rem; }
            .contact-btn { padding: 1rem 2rem; font-size: 1.2rem; }
            .modal-content { padding: 1.5rem; }
            .modal-content h3 { font-size: 2rem; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500&family=Cormorant+Garamond:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Firebase SDK (modular) with YOUR config -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCZuRu_GQ4zU8v9I00cIA0VI0J5pXqSEQE",
            authDomain: "rasulicarpet.firebaseapp.com",
            projectId: "rasulicarpet",
            storageBucket: "rasulicarpet.firebasestorage.app",
            messagingSenderId: "119770074051",
            appId: "1:119770074051:web:115852e39b92a9f7a98b76"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const productsCollection = collection(db, 'products');

        // Make db and functions globally available for inline scripts
        window.db = db;
        window.productsCollection = productsCollection;
        window.getDocs = getDocs;
        window.addDoc = addDoc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.doc = doc;
        window.query = query;
        window.orderBy = orderBy;
        window.collection = collection;
    </script>
</head>
<body>
    <!-- WELCOME OVERLAY -->
    <div id="welcome-overlay">
        <div class="welcome-text">RASULI CARPETS</div>
    </div>

    <!-- CART AREA -->
    <div class="cart-area">
        <div class="cart-icon" id="cartIcon">
            <span>üëú</span>
            <span class="cart-count" id="cartCount">0</span>
            <span>bag</span>
        </div>
        <div class="cart-dropdown" id="cartDropdown">
            <h3 style="font-family: 'Cormorant Garamond'; margin-bottom: 1rem;">your bag</h3>
            <div id="cartItemsContainer"></div>
            <button id="closeCart" style="margin-top: 1rem; background: none; border:1px solid; border-radius:30px; padding:0.4rem 1rem;">close</button>
        </div>
    </div>

    <!-- HERO -->
    <section class="hero">
        <div class="hero-content">
            <h1>Rasuli Carpets</h1>
            <p>Handcrafted Afghan Rugs</p>
            <button class="btn-hero" onclick="document.getElementById('products-section').scrollIntoView({behavior:'smooth'})">View Collection</button>
        </div>
    </section>

    <div class="container">
        <section id="products-section">
            <h2 class="section-title title-font">Our Collection</h2>
            <div class="filter-group">
                <button class="filter-btn active" id="filterAll">Show All</button>
                <button class="filter-btn" data-size="Small">Small Rugs</button>
                <button class="filter-btn" data-size="Large">Large Rugs</button>
            </div>
            <div class="product-grid" id="productGrid"></div>
        </section>

        <div class="contact-section">
            <a href="#" class="contact-btn" id="whatsappBtn" target="_blank">üì± WhatsApp</a>
            <a href="#" class="contact-btn" id="emailBtn" target="_blank">‚úâÔ∏è Email</a>
        </div>
    </div>

    <footer>
        <span>¬© Rasuli Carpets ‚Äî heritage rugs</span>
        <span>UsmanRasuli65@gmail.com</span>
    </footer>

    <!-- SECRET ADMIN MODALS -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" id="closeLoginModal">&times;</button>
            <h3>owner access</h3>
            <div class="modal-form">
                <input type="password" id="adminPasswordInput" placeholder="password">
                <button id="submitPassword">unlock</button>
                <div id="loginError" class="error-msg"></div>
            </div>
        </div>
    </div>

    <div id="adminModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" id="closeAdminModal">&times;</button>
            <h3>artisan control</h3>
            <div class="modal-form" id="adminForm">
                <input type="text" id="prodName" placeholder="name (e.g. 'Herat')" required>
                <select id="prodSize">
                    <option value="Small">Small</option>
                    <option value="Large">Large</option>
                </select>
                <textarea id="prodDesc" placeholder="short description" rows="2"></textarea>
                <input type="file" id="prodImageFile" accept="image/*">
                <img id="imagePreview" class="image-preview" src="" alt="preview" style="display:none;">
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                    <button id="addProductBtn">Add product</button>
                    <button class="secondary" id="cancelEditBtn" style="display:none;">Cancel edit</button>
                    <button class="secondary" id="deleteAllBtn" style="background:#b34a4a;">Delete all products</button>
                </div>
            </div>
            <div id="adminProductList" style="margin-top: 2rem;"></div>
        </div>
    </div>

    <script type="module">
        // ---------- MAIN APPLICATION WITH FIREBASE ----------
        import { getDocs, addDoc, updateDoc, deleteDoc, doc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // ---------- CONFIG ----------
        const ADMIN_PASSWORD = "UsmanRasuli890";
        const WHATSAPP_NUMBER = '15023890653';
        const EMAIL_ADDRESS = 'UsmanRasuli65@gmail.com';

        document.getElementById('whatsappBtn').href = `https://wa.me/${WHATSAPP_NUMBER}?text=Hello%20I%20am%20interested%20in%20your%20rug`;
        document.getElementById('emailBtn').href = `mailto:${EMAIL_ADDRESS}`;

        // ---------- GLOBAL STATE ----------
        let products = [];               // will be loaded from Firebase
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentFilter = 'All';
        let adminAuthenticated = false;
        let editingId = null;            // Firestore document ID

        // ---------- FIREBASE HELPERS ----------
        async function loadProductsFromFirebase() {
            try {
                const q = query(productsCollection, orderBy('name')); // optional order
                const querySnapshot = await getDocs(q);
                products = [];
                querySnapshot.forEach((docSnap) => {
                    products.push({ id: docSnap.id, ...docSnap.data() });
                });
                renderProducts();
                if (adminAuthenticated) renderAdminProductList();
            } catch (error) {
                console.error("Error loading products: ", error);
            }
        }

        async function addProductToFirebase(product) {
            try {
                const docRef = await addDoc(productsCollection, product);
                product.id = docRef.id;
                products.push(product);
                renderProducts();
                if (adminAuthenticated) renderAdminProductList();
            } catch (error) {
                console.error("Error adding product: ", error);
            }
        }

        async function updateProductInFirebase(id, updatedData) {
            try {
                const productRef = doc(db, 'products', id);
                await updateDoc(productRef, updatedData);
                const index = products.findIndex(p => p.id === id);
                if (index !== -1) {
                    products[index] = { ...products[index], ...updatedData };
                }
                renderProducts();
                if (adminAuthenticated) renderAdminProductList();
            } catch (error) {
                console.error("Error updating product: ", error);
            }
        }

        async function deleteProductFromFirebase(id) {
            try {
                await deleteDoc(doc(db, 'products', id));
                products = products.filter(p => p.id !== id);
                renderProducts();
                if (adminAuthenticated) renderAdminProductList();
                // remove from cart if present
                cart = cart.filter(c => c.id !== id);
                saveCart();
            } catch (error) {
                console.error("Error deleting product: ", error);
            }
        }

        async function deleteAllProductsFromFirebase() {
            try {
                const querySnapshot = await getDocs(productsCollection);
                const deletions = [];
                querySnapshot.forEach((docSnap) => {
                    deletions.push(deleteDoc(doc(db, 'products', docSnap.id)));
                });
                await Promise.all(deletions);
                products = [];
                renderProducts();
                if (adminAuthenticated) renderAdminProductList();
                cart = [];
                saveCart();
            } catch (error) {
                console.error("Error deleting all: ", error);
            }
        }

        // ---------- RENDER PRODUCTS (from products array) ----------
        function renderProducts() {
            const grid = document.getElementById('productGrid');
            const filtered = currentFilter === 'All' ? products : products.filter(p => p.size === currentFilter);
            grid.innerHTML = '';
            filtered.forEach(prod => {
                const card = document.createElement('div');
                card.className = 'product-card fade-scroll';
                card.innerHTML = `
                    <img class="product-img" src="${prod.image || 'https://images.unsplash.com/photo-1600166898405-da9535204843?w=400'}" alt="${prod.name}">
                    <div class="card-content">
                        <div class="product-name">${prod.name}</div>
                        <div class="product-size">${prod.size}</div>
                        <div class="product-desc">${prod.desc || 'hand knotted'}</div>
                        <button class="add-btn" data-id="${prod.id}">add to bag</button>
                    </div>
                `;
                grid.appendChild(card);
            });

            document.querySelectorAll('.add-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.dataset.id;
                    const product = products.find(p => p.id === id);
                    if (product) { 
                        cart.push(product); 
                        saveCart(); 
                        showCartDropdown(); 
                    }
                });
            });

            // scroll reveal
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('revealed'); });
            }, { threshold: 0.2 });
            document.querySelectorAll('.fade-scroll').forEach(el => observer.observe(el));
        }

        // ---------- CART FUNCTIONS ----------
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
        }

        function updateCartUI() {
            document.getElementById('cartCount').innerText = cart.length;
            const container = document.getElementById('cartItemsContainer');
            if (!container) return;
            if (cart.length === 0) { container.innerHTML = '<p style="color:#9e7e5e;">your bag is empty</p>'; return; }
            container.innerHTML = '';
            cart.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = 'cart-item';
                div.innerHTML = `
                    <img src="${item.image}" alt="thumb">
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div>${item.size}</div>
                    </div>
                    <button class="cart-item-remove" data-index="${idx}">‚úï</button>
                `;
                container.appendChild(div);
            });
            document.querySelectorAll('.cart-item-remove').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.dataset.index;
                    cart.splice(index, 1);
                    saveCart();
                    updateCartUI();
                });
            });
        }

        function showCartDropdown() {
            document.getElementById('cartDropdown').classList.add('show');
        }

        // ---------- FILTER BUTTONS ----------
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const size = btn.getAttribute('data-size');
                currentFilter = size || 'All';
                renderProducts();
            });
        });

        // ---------- ADMIN PANEL (Secret: Ctrl+Shift+A) ----------
        const loginModal = document.getElementById('loginModal');
        const adminModal = document.getElementById('adminModal');
        const closeLogin = document.getElementById('closeLoginModal');
        const closeAdmin = document.getElementById('closeAdminModal');
        const submitPassword = document.getElementById('submitPassword');
        const passwordInput = document.getElementById('adminPasswordInput');
        const loginError = document.getElementById('loginError');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const deleteAllBtn = document.getElementById('deleteAllBtn');

        function showLoginModal() { loginModal.classList.add('show'); }
        function hideLoginModal() { loginModal.classList.remove('show'); passwordInput.value = ''; loginError.innerText = ''; }
        function showAdminModal() { adminModal.classList.add('show'); renderAdminProductList(); }
        function hideAdminModal() { adminModal.classList.remove('show'); resetAdminForm(); }

        closeLogin.addEventListener('click', hideLoginModal);
        closeAdmin.addEventListener('click', hideAdminModal);

        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                if (adminAuthenticated) {
                    showAdminModal();
                } else {
                    showLoginModal();
                }
            }
        });

        submitPassword.addEventListener('click', () => {
            if (passwordInput.value === ADMIN_PASSWORD) {
                adminAuthenticated = true;
                hideLoginModal();
                showAdminModal();
            } else {
                loginError.innerText = 'incorrect password';
            }
        });

        loginModal.addEventListener('click', (e) => {
            if (e.target === loginModal) hideLoginModal();
        });
        adminModal.addEventListener('click', (e) => {
            if (e.target === adminModal) hideAdminModal();
        });

        // ---------- ADMIN RENDER LIST ----------
        async function renderAdminProductList() {
            const adminDiv = document.getElementById('adminProductList');
            if (products.length === 0) {
                adminDiv.innerHTML = '<p style="color:#d8c09e;">No products yet. Add some above.</p>';
                return;
            }
            adminDiv.innerHTML = '<h4 style="margin: 1rem 0; color:#ebd3b5;">manage existing rugs</h4>';
            products.forEach(p => {
                const item = document.createElement('div');
                item.className = 'admin-item';
                item.innerHTML = `
                    <img src="${p.image}" alt="">
                    <span style="flex:1;"><strong>${p.name}</strong> (${p.size})</span>
                    <button class="product-edit" data-id="${p.id}" style="background:#9f825d;">‚úé edit</button>
                    <button class="product-delete" data-id="${p.id}" style="background:#b34a4a;">delete</button>
                `;
                adminDiv.appendChild(item);
            });

            document.querySelectorAll('.product-edit').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.dataset.id;
                    openEditProduct(id);
                });
            });

            document.querySelectorAll('.product-delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.dataset.id;
                    if (confirm('Delete this product?')) {
                        deleteProductFromFirebase(id);
                    }
                });
            });
        }

        function openEditProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            editingId = id;
            document.getElementById('prodName').value = product.name;
            document.getElementById('prodSize').value = product.size;
            document.getElementById('prodDesc').value = product.desc || '';
            const preview = document.getElementById('imagePreview');
            preview.src = product.image;
            preview.style.display = 'inline-block';
            document.getElementById('addProductBtn').textContent = 'Update product';
            cancelEditBtn.style.display = 'inline-block';
        }

        function resetAdminForm() {
            document.getElementById('prodName').value = '';
            document.getElementById('prodSize').value = 'Small';
            document.getElementById('prodDesc').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imagePreview').src = '';
            document.getElementById('prodImageFile').value = '';
            document.getElementById('addProductBtn').textContent = 'Add product';
            cancelEditBtn.style.display = 'none';
            editingId = null;
        }

        // ---------- ADD/UPDATE PRODUCT ----------
        document.getElementById('addProductBtn').addEventListener('click', async () => {
            const name = document.getElementById('prodName').value.trim();
            const size = document.getElementById('prodSize').value;
            const desc = document.getElementById('prodDesc').value.trim() || 'handwoven wool';
            const fileInput = document.getElementById('prodImageFile');
            let image = null;

            if (fileInput.files.length > 0) {
                try {
                    image = await fileToBase64(fileInput.files[0]);
                } catch (e) { alert('Image conversion failed'); return; }
            } else if (editingId) {
                const existing = products.find(p => p.id === editingId);
                image = existing.image;
            } else {
                image = 'https://images.unsplash.com/photo-1600166898405-da9535204843?w=400';
            }

            if (!name) { alert('Name is required'); return; }

            const productData = { name, size, desc, image };

            if (editingId) {
                await updateProductInFirebase(editingId, productData);
            } else {
                await addProductToFirebase(productData);
            }
            resetAdminForm();
        });

        cancelEditBtn.addEventListener('click', resetAdminForm);

        // Delete all products
        deleteAllBtn.addEventListener('click', async () => {
            if (confirm('Delete ALL products? This cannot be undone.')) {
                await deleteAllProductsFromFirebase();
            }
        });

        // Helper: file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Image preview
        document.getElementById('prodImageFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'inline-block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Cart dropdown
        document.getElementById('cartIcon').addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('cartDropdown').classList.toggle('show');
        });
        document.getElementById('closeCart').addEventListener('click', () => {
            document.getElementById('cartDropdown').classList.remove('show');
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.cart-area')) {
                document.getElementById('cartDropdown').classList.remove('show');
            }
        });

        // Welcome overlay
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('welcome-overlay').classList.add('fade-out');
                setTimeout(() => {
                    document.getElementById('welcome-overlay').style.display = 'none';
                    document.body.classList.add('loaded');
                }, 1400);
            }, 2000);
        });

        // Initial load from Firebase
        loadProductsFromFirebase();
        updateCartUI();
    </script>
</body>
</html>